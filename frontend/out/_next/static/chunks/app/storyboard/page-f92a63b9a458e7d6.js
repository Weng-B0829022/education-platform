(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[728],{5461:(e,t,r)=>{Promise.resolve().then(r.bind(r,3843))},3843:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(7437),s=r(2265),o=r(3274);let n=e=>{let{headers:t,storyboardData:r,uploadedImages:o}=e,n=o.map(e=>URL.createObjectURL(e));return(0,s.useEffect)(()=>()=>{n.forEach(e=>URL.revokeObjectURL(e))},[n]),(0,a.jsx)("div",{className:"pr-2 pb-2",children:(0,a.jsx)("table",{className:"min-w-full border-collapse text-black",children:(0,a.jsx)("tbody",{children:t.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-center border px-2 py-2",children:e}),r.map((t,r)=>(0,a.jsx)("td",{className:"text-center border px-2 py-2",children:"畫面"===e?(0,a.jsx)("img",{src:n[r]||"/static/no-image.png",alt:t.畫面描述,className:"w-44 h-auto mx-auto"}):t[e]},r))]},e))})})})};var l=r(8557);let i={convertStoryboardToJson:e=>("\n\n"+e).split("\n\n").filter(Boolean).map((e,t)=>{let r=e.trim().split("\n"),a=r[1],s="",o="";for(let e=1;e<r.length;e++)r[e].startsWith("Image:")||r[e].startsWith("Video:")?s=r[e]:r[e].startsWith("Voiceover Text:")&&(o=r[e].split("Voiceover Text:")[1].trim());return{sceneNumber:t+1,timeCode:a,visualElements:s?[{type:s.toLowerCase().startsWith("image:")?"image":"video",content:s.split(":")[1].trim()}]:[],voiceoverText:o.replace(/^"|"$/g,"")}}),convertArticlesToJson(e){return e.articles.map(e=>({title:e.title,content:e.content,storyboard:this.convertStoryboardToJson(e.storyboard)}))},convertToStoryboardData(e){if(!e||"object"!=typeof e)return console.error("Invalid input: expected an object"),{title:"",content:"",storyboard:[]};let t={sceneNumber:0,timeCode:"0",visualElements:[{type:"image",content:"No description available"}],voiceoverText:""};return{title:e.title||"Untitled",content:e.content||"",storyboard:Array.isArray(e.storyboard)?e.storyboard.map((e,r)=>{var a;let s={...t,...e};return{段落:r.toString().padStart(2,"0"),秒數:s.timeCode,畫面:"https://picsum.photos/300/200?random=".concat(r+1),畫面描述:(null===(a=s.visualElements[0])||void 0===a?void 0:a.content)||"No description available",旁白:(s.voiceoverText||"").replace(/^「|」$/g,""),字數:"".concat((s.voiceoverText||"").replace(/^「|」$/g,"").length,"字")}}):[]}}},c=e=>{let{storyboardTitle:t}=e;return(0,a.jsxs)("div",{className:"w-full h-1/3 border border-gray-200 rounded",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-lg font-bold p-4 w-30",children:"主標題"}),t&&(0,a.jsx)("p",{className:"text-lg p-2 flex-1",children:t})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-lg font-bold p-4 w-30",children:"副標題"}),(0,a.jsx)("p",{className:"text-lg p-2 flex-1",children:"這是副標"})]})]})};var d=r(9903);let u=e=>{let{storyboardData:t,storyboardTitle:r}=e,[l,i]=(0,s.useState)(!1),[u,m]=(0,s.useState)(!1),[p,h]=(0,s.useState)(null),[b,g]=(0,s.useState)(0),[v,f]=(0,s.useState)("woman1-full"),[x,y]=(0,s.useState)(!1),[j,N]=(0,s.useState)([]);(0,s.useEffect)(()=>{let e;return u?e=setInterval(()=>{g(e=>e+1)},1e3):g(0),()=>{e&&clearInterval(e)}},[u]);let w=async()=>{m(!0),h(null),g(0);try{let e=new FormData,a={title:r,avatar:v.split("-")[0],avatarType:v.split("-")[1],storyboard:t.map(e=>({paragraph:e.段落,duration:e.秒數,calculatedDuration:function(e){let[t,r]=(e=e.replace(/\s/g,"")).split("-->");function a(e){let[t,r]=e.split(","),[a,s,o]=t.split(":");return 36e5*parseInt(a)+6e4*parseInt(s)+1e3*parseInt(o)+parseInt(r)}let s=a(t);return a(r)-s}(e.秒數),imageDescription:e.畫面描述,voiceover:e.旁白,avatarCount:parseInt(e.字數.replace(/[^0-9]/g,""))}))};e.append("story_object",JSON.stringify(a)),j.forEach((t,r)=>{e.append("image_".concat(r),t)});let s=await fetch("".concat(d.b.gen_video),{method:"POST",body:e}),o=await s.json();if(!s.ok)throw Error(o.message||"Failed to generate video");console.log("Video generation response:",o),h(o)}catch(e){console.error("Error generating video:",e),h({message:"Failed to generate video",image_urls:[],random_id:""})}finally{m(!1)}},S=async()=>{try{y(!0);let e=await fetch("".concat(d.b.upload_video),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({random_id:null==p?void 0:p.random_id})}),t=await e.json();if(!e.ok)throw Error(t.message||"Failed to generate video")}catch(e){console.error("Error uploading video:",e)}finally{y(!1)}};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"overflow-x-auto p-3 sm:p-4 group mt-4 ".concat(l?"":"border-gray-100 text-textLight hover:shadow-sm hover:border-neutral-100 hover:bg-blue-50 hover:text-blue-500"," font-bold border-2 rounded-md "),children:[(0,a.jsxs)("div",{onClick:()=>i(e=>!e),className:"cursor-pointer",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold ml-2 mt-2",children:"分鏡稿"}),(0,a.jsx)("p",{className:"mt-2 text-m ml-2 mb-2",children:"為單則影片之分鏡稿，依選擇模式可進行不同程度的調整"})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4 w-full",children:[(0,a.jsx)("div",{className:"w-48 flex-shrink-0",children:l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c,{storyboardTitle:r}),(0,a.jsx)("p",{className:"mt-2 text-m ml-2 mb-2",children:"選擇主播"}),(0,a.jsxs)("select",{onChange:e=>f(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none text-gray-700",children:[(0,a.jsx)("option",{value:"woman1-full",children:"woman1-full"}),(0,a.jsx)("option",{value:"woman1-half",children:"woman1-half"}),(0,a.jsx)("option",{value:"man1-full",children:"man1-full"}),(0,a.jsx)("option",{value:"man1-half",children:"man1-half"})]}),(0,a.jsx)("button",{onClick:w,className:"mb-2 mt-2 w-full p-2 border border-gray-300 rounded-md bg-blue-500 shadow-sm focus:outline-none text-white disabled:bg-blue-400",disabled:u||j.length<t.length,children:u?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 animate-spin"}),(0,a.jsxs)("span",{children:["影片生成中 已過",b,"秒"]})]}):"生成影片"}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["需上傳 ",t.length," 張圖片 (已上傳: ",j.length,")"]}),(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{let t=e.target.files;t&&N(e=>[...e,...Array.from(t)])},className:"hidden",id:"image-upload"}),(0,a.jsx)("label",{htmlFor:"image-upload",className:"w-full p-2 border border-gray-300 rounded-md bg-white text-center cursor-pointer block hover:bg-gray-50",children:"上傳圖片"})]})]})}),(0,a.jsx)("div",{className:"flex-1",children:l&&(0,a.jsx)(n,{headers:["段落","秒數","畫面","畫面描述","旁白","字數"],storyboardData:t,uploadedImages:j})})]})]}),p?(0,a.jsxs)("div",{className:"mt-4 p-4 bg-gray-100 rounded-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-2",children:"生成結果："}),(0,a.jsx)("div",{children:p.message?(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("video",{controls:!0,className:"w-full max-w-2xl mt-2",src:"".concat(d.b.get_generated_video,"?id=").concat(p.random_id),children:"Your browser does not support the video tag."}),(0,a.jsx)("button",{onClick:S,className:"mb-2 mt-2 w-full p-2 border border-gray-300 rounded-md bg-blue-500 shadow-sm  focus:outline-none text-white disabled:bg-blue-400",disabled:x,children:x?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 animate-spin"}),(0,a.jsx)("span",{children:"影片上傳中"})]}):"上傳影片至資料庫"})]}):(0,a.jsx)("p",{children:"發生未知的錯誤 請重新生成"})})]}):null]})},m=()=>{let{content:e}=(0,l.Y)(),[t,r]=(0,s.useState)([]),[o,n]=(0,s.useState)(""),[c,d]=(0,s.useState)(0),[m,p]=(0,s.useState)(null);return(0,s.useEffect)(()=>{e&&p(JSON.parse(e))},[e,c]),(0,s.useEffect)(()=>{if(m){let e=i.convertArticlesToJson(m);n(m.articles[c].title),r(i.convertToStoryboardData(e[c]).storyboard.slice(0))}},[m,c]),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("h1",{className:"text-3xl font-bold mb-0 ml-4",children:"Express Mode 生成結果"})}),(0,a.jsx)("p",{className:"mt-2 text-m",children:"播放日 2024-12-17"})]}),(0,a.jsxs)("div",{className:"mb-4 mt-4",children:[(0,a.jsx)("label",{htmlFor:"storyboardSelect",className:"mr-2",children:"選擇分鏡稿："}),(0,a.jsx)("select",{id:"storyboardSelect",value:c,onChange:e=>d(parseInt(e.target.value)),className:"border rounded p-1",children:m&&m.articles.map((e,t)=>(0,a.jsx)("option",{value:t,children:e.title},t))})]}),(0,a.jsx)(u,{storyboardData:t,storyboardTitle:o,selectedIndex:c})]})}},8030:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var a=r(2265);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:i,className:c="",children:d,iconNode:u,...m}=e;return(0,a.createElement)("svg",{ref:t,...n,width:s,height:s,stroke:r,strokeWidth:i?24*Number(l)/Number(s):l,className:o("lucide",c),...m},[...u.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),i=(e,t)=>{let r=(0,a.forwardRef)((r,n)=>{let{className:i,...c}=r;return(0,a.createElement)(l,{ref:n,iconNode:t,className:o("lucide-".concat(s(e)),i),...c})});return r.displayName="".concat(e),r}},3274:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});let a=(0,r(8030).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9903:(e,t,r)=>{"use strict";r.d(t,{b:()=>s});let a="http://163.25.111.55:8000",s={gen_video:"".concat(a,"/storyboard/execute-generate-video"),gen_storyboard:"".concat(a,"/generator/execute-generate-storyboard"),get_generated_video:"".concat(a,"/storyboard/get-generated-video"),upload_video:"".concat(a,"/storyboard/execute-news-upload")}},8557:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n});var a=r(903),s=r(9291);let o=()=>{try{return{content:localStorage.getItem("createdContent")||""}}catch(e){console.error("Error getting initial state:",e)}return{content:""}},n=(0,a.U)()((0,s.mW)(e=>({...o(),setContent:t=>{console.log(!0),localStorage.setItem("createdContent",t),e({content:t})}})))},9291:(e,t,r)=>{"use strict";r.d(t,{mW:()=>n});let a=new Map,s=e=>{let t=a.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},o=(e,t,r)=>{if(void 0===e)return{type:"untracked",connection:t.connect(r)};let s=a.get(r.name);if(s)return{type:"tracked",store:e,...s};let o={connection:t.connect(r),stores:{}};return a.set(r.name,o),{type:"tracked",store:e,...o}},n=(e,t={})=>(r,a,n)=>{let i;let{enabled:c,anonymousActionType:d,store:u,...m}=t;try{i=(null==c||c)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(e){}if(!i)return e(r,a,n);let{connection:p,...h}=o(u,i,m),b=!0;n.setState=(e,t,o)=>{let l=r(e,t);if(!b)return l;let i=void 0===o?{type:d||"anonymous"}:"string"==typeof o?{type:o}:o;return void 0===u?null==p||p.send(i,a()):null==p||p.send({...i,type:`${u}/${i.type}`},{...s(m.name),[u]:n.getState()}),l};let g=(...e)=>{let t=b;b=!1,r(...e),b=t},v=e(n.setState,a,n);if("untracked"===h.type?null==p||p.init(v):(h.stores[h.store]=n,null==p||p.init(Object.fromEntries(Object.entries(h.stores).map(([e,t])=>[e,e===h.store?v:t.getState()])))),n.dispatchFromDevtools&&"function"==typeof n.dispatch){let e=!1,t=n.dispatch;n.dispatch=(...r)=>{"__setState"!==r[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...r)}}return p.subscribe(e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload){console.error("[zustand devtools middleware] Unsupported action format");return}return l(e.payload,e=>{if("__setState"===e.type){if(void 0===u){g(e.state);return}1!==Object.keys(e.state).length&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let t=e.state[u];if(null==t)return;JSON.stringify(n.getState())!==JSON.stringify(t)&&g(t);return}n.dispatchFromDevtools&&"function"==typeof n.dispatch&&n.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":if(g(v),void 0===u)return null==p?void 0:p.init(n.getState());return null==p?void 0:p.init(s(m.name));case"COMMIT":if(void 0===u){null==p||p.init(n.getState());break}return null==p?void 0:p.init(s(m.name));case"ROLLBACK":return l(e.state,e=>{if(void 0===u){g(e),null==p||p.init(n.getState());return}g(e[u]),null==p||p.init(s(m.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return l(e.state,e=>{if(void 0===u){g(e);return}JSON.stringify(n.getState())!==JSON.stringify(e[u])&&g(e[u])});case"IMPORT_STATE":{let{nextLiftedState:r}=e.payload,a=null==(t=r.computedStates.slice(-1)[0])?void 0:t.state;if(!a)return;void 0===u?g(a):g(a[u]),null==p||p.send(null,r);break}case"PAUSE_RECORDING":return b=!b}return}}),v},l=(e,t)=>{let r;try{r=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==r&&t(r)}},903:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});var a=r(2265);let s=e=>{let t;let r=new Set,a=(e,a)=>{let s="function"==typeof e?e(t):e;if(!Object.is(s,t)){let e=t;t=(null!=a?a:"object"!=typeof s||null===s)?s:Object.assign({},t,s),r.forEach(r=>r(t,e))}},s=()=>t,o={setState:a,getState:s,getInitialState:()=>n,subscribe:e=>(r.add(e),()=>r.delete(e))},n=t=e(a,s,o);return o},o=e=>e?s(e):s,n=e=>e,l=e=>{let t=o(e),r=e=>(function(e,t=n){let r=a.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return a.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},i=e=>e?l(e):l}},e=>{var t=t=>e(e.s=t);e.O(0,[130,215,744],()=>t(5461)),_N_E=e.O()}]);